/*
 * Audio Player
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/audioplayer
 * @version: 2.0.0
 *
 * @license: The MIT License (MIT)
 * Copyright (c) 2014 - 2018 Media Serivces
 *
 */
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),APlayer=function(){function e(){_classCallCheck(this,e),this.el={splash:"#ap-splash",splashTitle:"#ap-splash .cover-info .title",splashSubtitle:"#ap-splash .cover-info .subtitle",splashAuthor:"#ap-splash .cover-info .author",splashLength:"#ap-splash .cover-info .length",startBtn:"#ap-start-btn",resumeBtn:"#ap-resume-btn",dwnldBtn:"#ap-dwnld-btn",dwnldBtnMenu:"#ap-dwnld-btn .dropdown-content",mainDwnldBtn:"#ap-download-cntrl",main:"#ap-main",mainBody:"#ap-main .body",showProfileBtn:"#show-profile",closeOverlayBtn:"#overlay-close-btn",overlayDisplay:"#overlay-content",overlayDisplayContent:"#overlay-content .content",overlayDisplaySpinner:"#overlay-content .spinner",currentPic:".head .track-img button",trackTitle:".track-info .title-wrapper .title",trackAuthor:".track-info .author",currentTrackNum:".track-info .meta .current",totalTracks:".track-info .meta .total",miniDisplay:".track-list .minimized-display",upNextTrack:".track-list .minimized-display .ap_up_next_title",trackList:".track-list .tracks",trackListItem:".track-list .tracks li .ap-track",expandTracksBtn:".track-list .expand-btn",next:"#ap-next",previous:"#ap-previous",warning:"body .warning-msg",captionBtn:"#ap-caption",error:"#ap-error",errorIcon:"#ap-error .icon",errorTitle:"#ap-error .title",errorBody:"#ap-error .body",playerId:"#player",copyright:".copyright p"},this.manifest={},this.album={url:"assets/album.xml",program:{},downloads:[],currentTrack:0,sameAuthor:!0,sameAuthorLoaded:!1,analyticsOn:!1,hasCaption:!1},this.player=null,this.reference={names:this._parseUri(window.location.href),fileName:"album"},this.marquee={start:null,stop:null},this.getManifest()}return _createClass(e,[{key:"getManifest",value:function e(){var t=this,a=t._selector("#ap-manifest").getAttribute("href");t._requestFile(a,function(e){t.manifest=JSON.parse(e.response),0===t.manifest.ap_root_directory.length&&(t.manifest.ap_root_directory="source/"),t.setUIs()})}},{key:"setUIs",value:function e(){var t=this,a=t.manifest.ap_root_directory+"script/templates/apui.tpl";t._requestFile(a,function(e){var a=t._selector("body"),r=e.response.replace(/\{([source)]+)\}/gi,t.manifest.ap_root_directory);a.innerHTML+=r,t._checkSupport(),t._setStartResumeListeners(),t._expandDownloadBtnMenu(),t.expandTracksToggle(),t._setShowProfileListener(),t.getAlbum()})}},{key:"_trackListItemListener",value:function e(){var t=this,a=t._selector(t.el.trackListItem,!0);Array.prototype.forEach.call(a,function(e){e.addEventListener("click",function(e){"track-download"!==e.target.className&&"svg"!==e.target.nodeName&&"use"!==e.target.nodeName&&(t.album.currentTrack=e.currentTarget.getAttribute("data-index"),t.setTrack(Number(t.album.currentTrack)),e.preventDefault())})})}},{key:"_expandDownloadBtnMenu",value:function e(){var t=this,a=t._selector(t.el.dwnldBtn),r=a.querySelector("button"),n=t._selector(t.el.dwnldBtnMenu);a.addEventListener("mouseenter",function(){r.setAttribute("aria-expanded",!0),n.setAttribute("aria-expanded",!0)}),a.addEventListener("mouseleave",function(){r.setAttribute("aria-expanded",!1),n.setAttribute("aria-expanded",!1)})}},{key:"_setStartResumeListeners",value:function e(){var t=this;if(t._selector(t.el.startBtn).addEventListener("click",function(){t.hideSplash(),t.sendEventToGA("StartBtn","click",t.reference.fileName),t.setTrack(t.album.currentTrack)}),Modernizr.localstorage){var a=t._selector(t.el.resumeBtn),r=JSON.parse(window.localStorage.getItem("ap-player"));null!==r&&(r.track>=1||r.time>0)&&(a.style.display="block",a.addEventListener("click",function(){t.sendEventToGA("ResumeBtn","click",t.reference.fileName),t.hideSplash(),t.setTrack(r.track,r.time)}))}}},{key:"getAlbum",value:function e(){var t=this;t._requestFile(t.album.url,function(e){var a=e.responseXML,r=t._xmlSelector(a,"album"),n=t._xmlSelector(a,"setup"),s=t._xmlSelector(a,"track",!0);t.album.settings={},t.album.settings.accent=r.getAttribute("accent"),t.album.settings.splashFormat="."+r.getAttribute("splashImgFormat"),t.album.settings.trackImgFormat="."+r.getAttribute("trackImgFormat"),t.album.settings.analytics=r.getAttribute("analytics"),t.album.settings.version=r.getAttribute("xmlVersion"),t.album.title=t._xmlSelector(n,"title").textContent,t.album.subtitle=t._xmlSelector(n,"subtitle").textContent,t.album.author=t._xmlSelector(n,"author").getAttribute("name"),t.album.authorProfile=t._xmlSelector(n,"author").textContent,t.album.length=t._xmlSelector(n,"length").textContent,t._isEmpty(n.getAttribute("program"))?void 0!==t.reference.names[3]&&(t.album.program.name=t.reference.names[3].toLowerCase()):t.album.program.name=n.getAttribute("program").toLowerCase(),t._isEmpty(n.getAttribute("course"))||(t.album.program.course=n.getAttribute("course")),t.album.tracks=[],Array.prototype.forEach.call(s,function(e){var a={};a.src=e.getAttribute("src"),a.title=e.querySelector("title").innerHTML,a.author=e.querySelector("author").getAttribute("name"),a.authorProfile=e.querySelector("author").innerHTML,t._isEmpty(a.author)&&(a.author=t.album.author),a.author!==t.album.author&&(t.album.sameAuthor=!1),t._isEmpty(a.author)?a.img=t._sanitize(t.album.author)+t.album.settings.trackImgFormat:a.img=t._sanitize(a.author)+t.album.settings.trackImgFormat,t.album.tracks.push(a)}),"on"!==t.album.settings.analytics&&"yes"!==t.album.settings.analytics||t._isEmpty(t.manifest.ap_google_tracking_id)||t.addGATracking(t.manifest.ap_google_tracking_id,t.album.settings.version),t.setData(),t._setupAudioPlayer()})}},{key:"setTrack",value:function e(t,a){a=void 0!==a?a:0;var r=this;t=Number(t),r.album.currentTrack=t;var n=r._selector(r.el.trackTitle);if(n.innerHTML=r.album.tracks[t].title,r._selector(r.el.trackAuthor).innerHTML=r.album.tracks[t].author,r.album.sameAuthor||r._loadAuthorPic(r.album.tracks[t]),r.album.sameAuthor&&!1===r.album.sameAuthorLoaded&&(r._loadAuthorPic(r.album.tracks[t]),r.album.sameAuthorLoaded=!0),r.album.tracks.length>1){r._selector(r.el.currentTrackNum).innerHTML=t+1,r._selector(r.el.totalTracks).innerHTML=r.album.tracks.length;var s=r._selector(r.el.trackListItem,!0);Array.prototype.forEach.call(s,function(e){e.parentNode.classList.remove("active")}),s[t].parentNode.classList.add("active")}var i=r._selector(r.el.upNextTrack);if(r.album.tracks.length>1&&t<r.album.tracks.length-1&&(i.innerHTML=r.album.tracks[t+1].title),null!==r.player){r.player.playing&&r.player.stop();var l="assets/audio/"+r.album.tracks[t].src+".vtt";r._fileExists(l,function(e){e?(r.player.source={type:"video",title:r.album.tracks[t].title,sources:[{src:"assets/audio/"+r.album.tracks[t].src+".mp3",type:"audio/mp3"}],tracks:[{kind:"captions",label:"English",srclang:"en",src:"assets/audio/"+r.album.tracks[t].src+".vtt",default:!0}]},r._closeTrackList(),r.album.hasCaption=!0):(r.player.source={type:"video",title:r.album.tracks[t].title,sources:[{src:"assets/audio/"+r.album.tracks[t].src+".mp3",type:"audio/mp3"}]},r._openTrackList(),r.album.hasCaption=!1),r.player.on("ready",function(){r._handlePlayerReady(),r.player.play(),r.album.hasCaption&&r.player.toggleCaptions(!0),a>0?document.getElementsByTagName("video")[0].currentTime=a:window.setTimeout(function(){Modernizr.localstorage&&window.localStorage.setItem("ap-player",JSON.stringify({track:t,time:a}))},3e3)})})}r._stopMarquee(n),r._marqueeEl(n)}},{key:"_loadAuthorPic",value:function e(t){var a=this,r=a._selector(a.el.currentPic),n="assets/images/"+t.img,s=a.manifest.ap_author_directory+a._sanitize(t.author)+a.album.settings.trackImgFormat,i=new Image;i.src=a.manifest.ap_root_directory+"images/pic.png",a._fileExists(n,function(e){e?i.src=n:a._fileExists(s,function(e){e&&(i.src=s)})}),r.innerHTML="",r.appendChild(i)}},{key:"setData",value:function e(){var t=this;this._selector("title").innerHTML=this.album.title;var a=this._selector(this.el.splashTitle),r=this._selector(this.el.splashSubtitle),n=this._selector(this.el.splashAuthor),s=this._selector(this.el.splashLength);if(a.innerHTML=this.album.title,r.innerHTML=this.album.subtitle,n.innerHTML=this.album.author,s.innerHTML=this.album.length,t.reference.names.length>0&&(this.reference.fileName=t.reference.names[t.reference.names.length-1]),Array.prototype.forEach.call(this.manifest.ap_download_files,function(e){var a=t.reference.fileName+"."+e.format;t._fileExists(a,function(r){if(r){var n=document.createElement("a");n.href=a,n.setAttribute("role","menuitem"),n.setAttribute("download",a),n.innerHTML=e.label,n.addEventListener("click",function(){t.sendEventToGA(e.label+"DwnldLink","click",t.reference.fileName)});t._selector(t.el.dwnldBtnMenu).appendChild(n);var s=t._selector(t.el.dwnldBtn);s.setAttribute("aria-hidden",!1),s.style.display="block";var i={name:e.label,url:a};t.album.downloads.push(i)}})}),!this._isEmpty(this.album.program.name)){var i=this.manifest.ap_splash_directory+this.album.program.name+"/default"+this.album.settings.splashFormat;this._isEmpty(t.album.program.course)||(i=this.manifest.ap_splash_directory+this.album.program.name+"/"+this.album.program.course+this.album.settings.splashFormat),this._fileExists(i,function(e){if(e){var a=t._selector(t.el.splash),r=t._selector("head"),n='url("'+i+'")';a.style.backgroundImage=n;var s=document.createElement("style");s.setAttribute("type","text/css"),s.innerHTML="#ap-main:before{background-image: "+n+" !important;}",r.appendChild(s)}})}if(!this._isEmpty(t.album.settings.accent)){var l=t._colorContrast(t.album.settings.accent),o=this.manifest.ap_root_directory+"script/templates/accent_css.tpl";this._requestFile(o,function(e){var a=e.response.replace(/\{([accent)]+)\}/gi,t.album.settings.accent);a=a.replace(/\{([accentText)]+)\}/gi,l);var r=t._selector("head"),n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=a,r.appendChild(n)})}if(this.album.tracks.length>1){var c=this._selector(this.el.trackList);Array.prototype.forEach.call(this.album.tracks,function(e,a){var r=document.createElement("li"),n=document.createElement("a");n.classList.add("ap-track"),n.href="javascript:void(0);",n.setAttribute("data-index",a);var s=document.createElement("span");s.classList.add("track-num"),s.innerHTML=a+1+".";var i=document.createElement("span");i.classList.add("track-title-wrapper");var l=document.createElement("span");if(l.classList.add("track-title"),l.setAttribute("title",e.title),l.innerHTML=e.title,i.appendChild(l),!t.album.sameAuthor){var o=document.createElement("img"),u="assets/images/"+t.album.tracks[a].img,d=t.manifest.ap_author_directory+t._sanitize(t.album.tracks[a].author)+t.album.settings.trackImgFormat;o.classList.add("track-img"),o.src=t.manifest.ap_root_directory+"images/pic.png",t._fileExists(u,function(e){e?o.src=u:t._fileExists(d,function(e){e&&(o.src=d)})}),n.appendChild(o)}n.appendChild(s),n.appendChild(i);var m=document.createElement("a");m.classList.add("track-download"),m.setAttribute("download",e.src+".mp3"),m.href="assets/audio/"+e.src+".mp3",m.setAttribute("role","button"),m.addEventListener("click",function(){t.sendEventToGA(e.src+"TrackDwnldLink","click",t.reference.fileName)});var p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.classList.add("icon"),p.setAttribute("aria-hidden",!0),p.setAttribute("viewbox","0 0 30 30");var h=document.createElementNS("http://www.w3.org/2000/svg","use");h.setAttributeNS("http://www.w3.org/1999/xlink","href",t.manifest.ap_root_directory+"images/icons.svg#icon-download"),p.appendChild(h),m.appendChild(p),n.appendChild(m),r.appendChild(n),c.appendChild(r)}),t._openTrackList(),t._trackListItemListener()}else this._selector(this.el.main).classList.add("single");var u=this._selector(this.el.copyright),d=new Date,m=d.getFullYear();u.innerHTML+="&copy; "+m+". "+this.manifest.ap_copyright,this._setProgram()}},{key:"_setupAudioPlayer",value:function e(){var t=this,a=t.manifest.ap_root_directory+"script/templates/single_plyr_controls.tpl";t.album.tracks.length>1&&(a=t.manifest.ap_root_directory+"script/templates/full_plyr_controls.tpl"),t._requestFile(a,function(e){var a=e.response.replace(/\{([source)]+)\}/gi,t.manifest.ap_root_directory),r=!1;Modernizr.localstorage&&(r=!0),t.player=new Plyr(t.el.playerId,{controls:a,hideControls:!1,autoplay:!1,volume:.8,clickToPlay:!1,fullscreen:{enabled:!1,fallback:!1,iosNative:!1},captions:{active:!0,language:"en",update:!1},resetOnEnd:!0,storage:{enabled:r,key:"plyr"}}),t.player.on("ready",function(){var e=t._selector(".plyr__captions"),a=t._selector(t.el.mainBody).offsetHeight,r=-1*(a-40);e.style.top=r+"px",e.style.height=a+"px";var n=t._selector(t.el.mainDwnldBtn);if(t.album.tracks.length>1){var s=t.album.tracks.length-1,i=t._selector(t.el.next),l=t._selector(t.el.previous);t.album.currentTrack<=0&&(l.setAttribute("disabled",!0),l.classList.add("disabled")),t.album.currentTrack>=s&&(i.setAttribute("disabled",!0),i.classList.add("disabled")),i.addEventListener("click",function(){t.album.currentTrack<s&&(t.album.currentTrack++,t.setTrack(t.album.currentTrack))}),l.addEventListener("click",function(){t.album.currentTrack>0&&(t.album.currentTrack--,t.setTrack(t.album.currentTrack))})}n.addEventListener("click",function(){var e=t._selector(t.el.overlayDisplay),a=t._selector(t.el.overlayDisplayContent),r=t._selector(t.el.closeOverlayBtn),n=document.createElement("h4");n.innerHTML="Downloads",a.appendChild(n);var s=document.createElement("ul");s.classList.add("dwnld-list"),Array.prototype.forEach.call(t.album.downloads,function(e){var a=document.createElement("li"),r=document.createElement("a");r.href=e.url,r.innerHTML=e.name,r.setAttribute("download",e.url),r.addEventListener("click",function(){t.sendEventToGA(e.name+"DwnldLink","click",t.reference.fileName)}),a.appendChild(r),s.appendChild(a)}),a.appendChild(s),e.classList.add("small-overlay"),e.style.display="block",t._fadeIn(e),r.addEventListener("click",function(){t.closeOverlay()},{once:!0})})})})}},{key:"_handlePlayerReady",value:function e(){for(var t=this,a=t._selector("#ap-playpause"),r=t._selector("#ap-muteunmute"),n=t._selector("#ap-playbackRate"),s=t._selector(t.el.captionBtn),i=0;i<n.options.length;i++)if(Number(n.options[i].value)===t.player.speed){n.selectedIndex=i;break}t.player.currentTrack>=0?s.classList.add("plyr__control--pressed"):s.classList.remove("plyr__control--pressed"),t.player.on("captionsenabled",function(){s.classList.add("plyr__control--pressed"),t.album.tracks.length>1&&t._closeTrackList()}),t.player.on("captionsdisabled",function(){if(s.classList.remove("plyr__control--pressed"),t.album.tracks.length>1&&t._openTrackList(),Modernizr.localstorage){var e=JSON.parse(window.localStorage.getItem("plyr"));delete e.captions,window.localStorage.setItem("plyr",JSON.stringify(e))}}),t.player.on("playing",function(){a.classList.add("plyr__control--pressed")}),t.player.on("pause",function(){a.classList.remove("plyr__control--pressed"),Modernizr.localstorage&&window.localStorage.setItem("ap-player",JSON.stringify({track:t.album.currentTrack,time:t.player.currentTime}))}),Modernizr.localstorage&&t.player.on("timeupdate",function(){var e=Number(t.album.currentTrack)+1,a=t.player.currentTime,r=a/t.player.duration;a>=3&&a<=4&&t.sendEventToGA("Playback","start",t.reference.fileName+":track"+e),r>=.45&&r<=.5&&(window.localStorage.setItem("ap-player",JSON.stringify({track:t.album.currentTrack,time:t.player.currentTime})),t.sendEventToGA("Playback","halfway",t.reference.fileName+":track"+e))}),t.player.on("ended",function(){var e=Number(t.album.currentTrack)+1;a.classList.contains("plyr__control--pressed")&&a.classList.add("plyr__control--pressed"),Modernizr.localstorage&&window.localStorage.setItem("ap-player",JSON.stringify({track:t.album.currentTrack,time:0})),t.sendEventToGA("Playback","completed",t.reference.fileName+":track"+e),t.player.restart()}),n.addEventListener("change",function(e){t.player.speed=Number(e.target.options[e.target.selectedIndex].value)}),r.addEventListener("click",function(e){e.target.classList.contains("plyr__control--pressed")?e.target.classList.remove("plyr__control--pressed"):e.target.classList.add("plyr__control--pressed")})}},{key:"_setProgram",value:function e(){var t=this;t.manifest.ap_custom_themes&&(t.album.program=t.manifest.ap_custom_themes.find(function(e){return e.name===t.album.program.name}),void 0===t.album.program&&(t.album.program=t.manifest.ap_custom_themes.find(function(e){return e.name===t.manifest.ap_logo_default})));var a=t._selector(".program-theme");t.album.program.colors.forEach(function(e){var t=document.createElement("span");t.style.backgroundColor=e,a.appendChild(t)})}},{key:"_checkSupport",value:function e(){if(this.hasCoreFeaturesSupport())return void this.showError("ðŸ™ˆ","",'Your web browser does not support core audio player features.<br><a href="http://outdatedbrowser.com/en" target="_blank">Please update your web browser.</a>');this.hasAppearanceIusses()&&this.showWarning("Your web browser does not support some of the player's features. For better viewing experience, try a different web browser.")}},{key:"hasCoreFeaturesSupport",value:function e(){return!!(!Modernizr.audio&&Modernizr.json&&Modernizr.json&&Modernizr.csscalc&&Modernizr.flexbox)}},{key:"hasAppearanceIusses",value:function e(){return!Modernizr.svg||(!Modernizr.cssanimations||(!Modernizr.bgsizecover||!Modernizr.objectfit))}},{key:"showError",value:function e(t,a,r){var n=this._selector(this.el.splash),s=this._selector(this.el.main),i=this._selector(this.el.error),l=this._selector(this.el.errorIcon),o=this._selector(this.el.errorTitle),c=this._selector(this.el.errorBody),u=document.createAttribute("aria-hidden");u.value=!1,l.innerHTML=t,o.innerHTML=a,c.innerHTML=r,n.style.display="none",s.style.display="none",i.style.display="flex",i.setAttributeNode(u),this._fadeIn(i)}},{key:"showWarning",value:function e(t){var a=this,r=a._selector(a.el.warning),n=1e4;r.innerHTML=t,r.style.display="block",a._fadeIn(r),window.setTimeout(function(){a._fadeOut(r,function(){r.innerHTML="",r.style.display="none"})},1e4)}},{key:"hideSplash",value:function e(){var t=this._selector(this.el.splash),a=document.createAttribute("aria-hidden");a.value=!0,t.classList.add("hide-splash"),t.setAttributeNode(a)}},{key:"showProfile",value:function e(){var t=this,a=this._selector(this.el.overlayDisplay),r=this._selector(this.el.closeOverlayBtn),n=Number(t._selector(t.el.currentTrackNum).innerHTML)-1;t.album.tracks.length<=1&&(n=0);var s=t.album.tracks[n].author,i=t.album.authorProfile;if(t._isEmpty(t.album.tracks[n].authorProfile)||(i=t.album.tracks[n].authorProfile),t._isEmpty(i)){var l=t.manifest.ap_author_directory+t._sanitize(s)+".json?callback=author";(function(){var e={},a=t._selector(t.el.overlayDisplaySpinner);return e.send=function(e,t){a.classList.add("spin");var r=t.callbackName||"callback",n=t.onSuccess||function(){},s=t.onTimeout||function(){},i=t.timeout||10,l=window.setTimeout(function(){window[r]=function(){},a.classList.remove("spin"),s()},1e3*i);window[r]=function(e){window.clearTimeout(l),a.classList.remove("spin"),n(e)};var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=e,document.getElementsByTagName("head")[0].appendChild(o)},e})().send(l,{callbackName:"author",onSuccess:function e(a){t._setProfile(a.name,a.profile)},onTimeout:function e(){t._setProfile(s,i)},timeout:5})}else t._setProfile(s,i);a.style.display="block",this._fadeIn(a),r.addEventListener("click",function(){t.closeOverlay()},{once:!0})}},{key:"_setProfile",value:function e(t,a){var r=this._selector(this.el.overlayDisplayContent),n=document.createElement("h4");n.innerHTML=t;var s=document.createElement("div");s.innerHTML=a,r.appendChild(n),r.appendChild(s)}},{key:"closeOverlay",value:function e(){var t=this._selector(this.el.overlayDisplay),a=this._selector(this.el.overlayDisplayContent);this._fadeOut(t,function(){t.style.display="",a.innerHTML="",t.classList.remove("small-overlay")})}},{key:"_setShowProfileListener",value:function e(){var t=this;this._selector(this.el.showProfileBtn).addEventListener("click",function(){t.showProfile()})}},{key:"expandTracksToggle",value:function e(){var t=this;t._selector(this.el.expandTracksBtn).addEventListener("click",function(){var e=t._selector(t.el.trackList);"none"==e.style.display||""==e.style.display?t._openTrackList():t._closeTrackList()})}},{key:"_openTrackList",value:function e(){var t=this,a=t._selector(t.el.trackList),r=t._selector(t.el.miniDisplay),n=t._selector(this.el.expandTracksBtn);a.style.display="block",r.style.display="none",t._slideDown(n.parentNode,function(){n.classList.add("rotate"),a.style.setProperty("overflow-y","auto")})}},{key:"_closeTrackList",value:function e(){var t=this,a=t._selector(t.el.trackList),r=t._selector(t.el.miniDisplay),n=t._selector(this.el.expandTracksBtn);a.style.display="none",a.style.setProperty("overflow-y","hidden"),r.style.display="flex",t._slideUp(n.parentNode,function(){n.classList.remove("rotate")})}},{key:"_selector",value:function e(t,a){return a="boolean"==typeof a&&a,a?document.querySelectorAll(t):document.querySelector(t)}},{key:"_xmlSelector",value:function e(t,a,r){return r="boolean"==typeof r&&r,r?t.querySelectorAll(a):t.querySelector(a)}},{key:"_sanitize",value:function e(t){return t.replace(/[^\w]/gi,"").toLowerCase()}},{key:"_isEmpty",value:function e(t){return"string"==typeof t&&""===t.trim()||(void 0===t||null===t)}},{key:"_requestFile",value:function e(t,a){var r=this,n=r._selector("body"),s=new XMLHttpRequest;s.open("GET",t,!0),s.onload=function(){this.status>=200&&this.status<400?a(this):n.innerHTML+='<div class="error">Error '+this.status+" while loading <code>"+t+"</code></div>",s.abort()},s.onerror=function(){n.innerHTML+='<div class="error">Connection Error. Check your network.</div>'},s.send()}},{key:"_fileExists",value:function e(t,a){var r=new XMLHttpRequest,n=!1;r.open("HEAD",t,!0),r.onload=function(){n=this.status>=200&&this.status<400,a(n)},r.send()}},{key:"_cleanArray",value:function e(t){return t.forEach(function(e,a){""===e&&t.splice(a,1)}),/(\w*|(\w*\-\w*)*)\.\w*/gi.test(t[t.length-1])&&t.pop(),/(\w*|(\w*\-\w*)*)\:/gi.test(t[t.length-1])&&t.pop(),t}},{key:"_parseUri",value:function e(t){var a=t.split("?"),r=a[0];return r.lastIndexOf("/")!==r.length-1&&(r+="/"),this._cleanArray(r.split("/"))}},{key:"_colorContrast",value:function e(t){var a=this._hexToRGB(t).split(",");return Math.round((299*parseInt(a[0])+587*parseInt(a[1])+114*parseInt(a[2]))/1e3)>125?"#000":"#fff"}},{key:"_hexToRGB",value:function e(t){t=t.replace(/[^0-9A-F]/gi,"");var a=parseInt(t,16);return[a>>16&255,a>>8&255,255&a].join()}},{key:"addGATracking",value:function e(t,a){this.album.analyticsOn=!0,function(e,t,a,r,n,s,i){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=1*new Date,s=t.createElement(a),i=t.getElementsByTagName(a)[0],s.async=1,s.src=r,i.parentNode.insertBefore(s,i)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",t,"auto"),ga("set",{appName:"Audio Player",appVersion:a}),ga("send","screenview",{screenName:this.reference.fileName})}},{key:"sendEventToGA",value:function e(t,a,r){this.album.analyticsOn&&ga("send","event",t,a,r,1,{screenName:this.reference.fileName})}},{key:"_marqueeEl",value:function e(t){var a=this;if(t.offsetWidth<t.scrollWidth){var r=15500,n=5e3;a.marquee.start=window.setInterval(function(){t.parentNode.classList.remove("stop-marquee"),t.parentNode.classList.add("marquee"),t.style.width=t.scrollWidth+"px",window.clearInterval(a.marquee.start),a.marquee.stop=window.setTimeout(function(){t.style.width="initial",t.parentNode.classList.remove("marquee"),window.clearTimeout(a.marquee.stop),a._fadeIn(t),a._marqueeEl(t)},15500)},5e3)}}},{key:"_stopMarquee",value:function e(t){t.style.width="",t.parentNode.classList.remove("marquee"),t.parentNode.classList.add("stop-marquee"),null!==this.marquee.stop&&window.clearTimeout(this.marquee.stop),null!==this.marquee.start&&window.clearInterval(this.marquee.start)}},{key:"_fadeIn",value:function e(t,a){if(t.classList.remove("fadeOut"),t.classList.add("fadeIn"),void 0!==a){var r=this._whichAnimationEvent();t.params={_event:r,_callback:a},t.addEventListener(r,this._fadeCallback)}}},{key:"_fadeOut",value:function e(t,a){if(t.classList.remove("fadeIn"),t.classList.add("fadeOut"),void 0!==a){var r=this._whichAnimationEvent();t.params={_event:r,_callback:a},t.addEventListener(r,this._fadeCallback)}}},{key:"_fadeCallback",value:function e(t){void 0!==t.target.params._callback&&"function"==typeof t.target.params._callback&&t.target.params._callback(),t.target.classList.remove("fadeIn"),t.target.classList.remove("fadeOut"),t.target.removeEventListener(t.target.params._event,this._fadeCallback),t.target.params={_event:"",_callback:""}}},{key:"_slideDown",value:function e(t,a){if(t.classList.add("slideDown"),t.classList.remove("slideUp"),void 0!==a){var r=this._whichAnimationEvent();t.params={_event:r,_callback:a},t.addEventListener(r,this._slideCallback)}}},{key:"_slideUp",value:function e(t,a){if(t.classList.add("slideUp"),t.classList.remove("slideDown"),void 0!==a){var r=this._whichAnimationEvent();t.params={_event:r,_callback:a},t.addEventListener(r,this._slideCallback)}}},{key:"_slideCallback",value:function e(t){void 0!==t.target.params&&("function"==typeof t.target.params._callback&&t.target.params._callback(),t.target.removeEventListener(t.target.params._event,this._slideCallback))}},{key:"_whichAnimationEvent",value:function e(){var t=void 0,a=document.createElement("fakeelement"),r={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in r)if(void 0!==a.style[t])return r[t]}}]),e}();!function e(t){(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?t():document.addEventListener("DOMContentLoaded",t)}(function(){new APlayer});
//# sourceMappingURL=./audio.js.map